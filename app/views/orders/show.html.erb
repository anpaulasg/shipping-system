<h2> <%= Order.model_name.human%>: <%= @order.delivery_code %></h2>

<div>
    <dl>
        <dt><strong><%= Order.human_attribute_name(:receiver_name)%>:</strong></dt>
        <dd><%= @order.receiver_name%><dd>
        <dt><strong><%= Order.human_attribute_name(:sender_address)%>:</strong></dt>
        <dd><%= @order.sender_address%><dd>
        <dt><strong><%= Order.human_attribute_name(:receiver_address)%>:</strong></dt>
        <dd><%= @order.receiver_address%></dd>
        <dt><strong><%= Order.human_attribute_name(:distance)%>:</strong></dt>
        <dd><%= @order.distance%> km</dd>
        <dt><strong><%= Order.human_attribute_name(:delivery_code)%>:</strong></dt> 
        <dd><%= @order.delivery_code%></dd>
        <dt><strong><%= Order.human_attribute_name(:product_code)%>:</strong></dt>
        <dd><%= @order.product_code%></dd>
        <dt><strong>Dimensão: </strong></dt>
        <dd><%= @order.height%> cm x <%= @order.width%> cm</dd>
        <dt><strong><%= Order.human_attribute_name(:weight)%>:</strong></dt>
        <dd><%= @order.weight%> kg</dd>
        <dt><strong><%= Order.human_attribute_name(:status)%>:</strong></dt>
        <dd><%= I18n.t(@order.status)%><dd>
    </dl>
</div>

<div>
<%=link_to('Iniciar Ordem de Pedido', new_order_order_shipping_path(order_id: @order.id))%>
</div>

<div>
    <h2> Informações | Frete e Entrega </h2>

    <% @order.order_shippings.each do | info |%>
        <% if info.delivery_mode_id == OrderShipping.last().delivery_mode_id && info.id != OrderShipping.last().id %>
            <dl> 
            <dt><strong><%= OrderShipping.human_attribute_name(:delivery_mode)%>:</strong></dt>
            <dd><%= info.delivery_mode.name%></dd>
            <dt><strong><%= OrderShipping.human_attribute_name(:final_price)%>:</strong></dt>
            <dd>R$<%= info.final_price%></dd>
            <dt><strong><%= OrderShipping.human_attribute_name(:final_term)%>:</strong></dt>
            <dd><%= info.final_term%>h</dd>
            <dt><strong><%= OrderShipping.human_attribute_name(:chosen_vehicle)%>:</strong></dt>
            <dd><%= info.chosen_vehicle%></dd>
            </dl>

        <% elsif info.delivery_mode_id != OrderShipping.last().delivery_mode_id%>
            <% OrderShipping.delete_by(delivery_mode_id:info.delivery_mode_id, order_id: OrderShipping.last().order_id) %>
        <% elsif OrderShipping.where(order_id: OrderShipping.last().order_id).count == 1 %>
            <dl> 
            <dt><strong><%= OrderShipping.human_attribute_name(:delivery_mode)%>:</strong></dt>
            <dd><%= info.delivery_mode.name%></dd>
            <dt><strong><%= OrderShipping.human_attribute_name(:final_price)%>:</strong></dt>
            <dd>R$<%= info.final_price%></dd>
            <dt><strong><%= OrderShipping.human_attribute_name(:final_term)%>:</strong></dt>
            <dd><%= info.final_term%>h</dd>
            <dt><strong><%= OrderShipping.human_attribute_name(:chosen_vehicle)%>:</strong></dt>
            <dd><%= info.chosen_vehicle%></dd>
            </dl>
        <% end %>

    <%end%>
    <% if OrderShipping.all.any? %>
        <% if OrderShipping.where(order_id: OrderShipping.last().order_id).count > 1 %>
            <% OrderShipping.last().delete %>
        <% end %>
    <% end %>
    
</div>

<% if admin?%>
    <%= button_to 'Pendente', pending_order_path(@order.id) %> 
    <%= button_to 'Iniciada', initiated_order_path(@order.id) %>
    <%= button_to 'Encerrada', terminated_order_path(@order.id) %>
<%end%>

<br>

<div>
    <%= link_to('Editar', edit_order_path(@order))%>
</div>

<div>
    <%= link_to('Voltar', orders_path) %>
</div>